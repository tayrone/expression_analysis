subgroup <- "g34"
library(readODS)
library(tidyverse)
library(pheatmap)
library(RTNsurvival)
library(oligo)
load(paste0("./rdata_files/network/", subgroup, "_rtn.RData"))
metadata <- read_ods("./input_files/data.ods", skip = 1)
colnames(metadata) <- tolower(colnames(metadata))
metadata$subgroup <- tolower(metadata$subgroup)
metadata$subgroup[metadata$subgroup == "group3"] <- "g3"
metadata$subgroup[metadata$subgroup == "group4"] <- "g4"
if(subgroup == "g34"){
metadata <- metadata[(metadata$subgroup == "g3" | metadata$subgroup == "g4"), ]
}else{
metadata <- metadata[metadata$subgroup == subgroup, ]
}
samples <- paste0("./input_files/", subgroup)
subgroup_samples <- oligoClasses::list.celfiles(samples, full.names = FALSE)
rownames(metadata) <- subgroup_samples
bad_samples <- bad_samples_list[[subgroup]]
load("/data4/tayrone25/medulloblastoma/expression_analysis/rdata_files/survival/g34_survival.RData")
install.packages('SuperExactTest')
library(readODS)
library(tidyverse)
library(pheatmap)
library(RTNsurvival)
library(oligo)
subgroup <- "g34"
load(paste0("./rdata_files/network/", subgroup, "_rtn.RData"))
metadata <- read_ods("./input_files/data.ods", skip = 1)
colnames(metadata) <- tolower(colnames(metadata))
colnames(metadata) <- tolower(colnames(metadata))
View(metadata)
View(metadata)
metadata$subgroup <- tolower(metadata$subgroup)
metadata$subgroup[metadata$subgroup == "group3"] <- "g3"
metadata$subgroup[metadata$subgroup == "group4"] <- "g4"
if(subgroup == "g34"){
metadata <- metadata[(metadata$subgroup == "g3" | metadata$subgroup == "g4"), ]
}else{
metadata <- metadata[metadata$subgroup == subgroup, ]
}
samples <- paste0("./input_files/", subgroup)
subgroup_samples <- oligoClasses::list.celfiles(samples, full.names = FALSE)
bad_samples_list <-
list(wnt = c("GSM2261712.CEL", "GSM2262154.CEL", "GSM2262232.CEL"),
shh = c("GSM2261629.CEL", "GSM2261633.CEL", "GSM2261689.CEL",
"GSM2261954.CEL", "GSM2261982.CEL", "GSM2262027.CEL",
"GSM2262066.CEL", "GSM2262074.CEL", "GSM2262084.CEL",
"GSM2262099.CEL", "GSM2262115.CEL", "GSM2262156.CEL",
"GSM2262165.CEL", "GSM2262178.CEL", "GSM2262189.CEL",
"GSM2262233.CEL", "GSM2262278.CEL", "GSM2262284.CEL",
"GSM2262286.CEL", "GSM2262295.CEL"),
g3 = c("GSM2261560.CEL", "GSM2261881.CEL", "GSM2262097.CEL",
"GSM2262155.CEL", "GSM2262229.CEL"),
g4 = c("GSM2261610.CEL", "GSM2261640.CEL", "GSM2261831.CEL",
"GSM2261884.CEL", "GSM2261985.CEL", "GSM2262013.CEL",
"GSM2262041.CEL", "GSM2262042.CEL", "GSM2262077.CEL",
"GSM2262148.CEL", "GSM2262149.CEL", "GSM2262161.CEL",
"GSM2262162.CEL", "GSM2262163.CEL", "GSM2262166.CEL",
"GSM2262219.CEL", "GSM2262231.CEL", "GSM2262264.CEL",
"GSM2262268.CEL", "GSM2262276.CEL", "GSM2262303.CEL",
"GSM2262313.CEL"),
g34 = c("GSM2261560.CEL", "GSM2261881.CEL", "GSM2262097.CEL",
"GSM2262155.CEL", "GSM2262229.CEL", "GSM2261610.CEL",
"GSM2261640.CEL", "GSM2261831.CEL", "GSM2262313.CEL",
"GSM2261884.CEL", "GSM2261985.CEL", "GSM2262013.CEL",
"GSM2262041.CEL", "GSM2262042.CEL", "GSM2262077.CEL",
"GSM2262148.CEL", "GSM2262149.CEL", "GSM2262161.CEL",
"GSM2262162.CEL", "GSM2262163.CEL", "GSM2262166.CEL",
"GSM2262219.CEL", "GSM2262231.CEL", "GSM2262264.CEL",
"GSM2262268.CEL", "GSM2262276.CEL", "GSM2262303.CEL"))
rownames(metadata) <- subgroup_samples
bad_samples <- bad_samples_list[[subgroup]]
metadata <- metadata[!(subgroup_samples %in% bad_samples), ]
#"event" and "time" variables are required, so we make them easier to identify
metadata <- dplyr::rename(metadata, event = dead, time = `os (years)`)
metadata <- dplyr::select(metadata, time, event, everything())
?tni2tnsPreprocess
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 10,
p.adjust = "bonferroni")
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 10,
pAdjustMethod = "bonferroni")
View(rtns)
rtns@para
rtns <- tnsGSEA2(rtns)
rtns <- tnsCox(rtns)
rtns <- tnsKM(rtns)
View(rtns)
rtns@results[["KM"]][["Fit"]][["ADC"]]
?tnsKM
tnsPlotKM(rtns, regs = "ADC")
rtns@results[["KM"]][["Fit"]][["ADC"]]
rtns@results[["Cox"]][["Fit"]][["ADC"]]
View(rtns@results[["Cox"]][["Table"]])
?tnsCox
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
View(hazardous_regulons)
tnsPlotKM(rtns, regs = "RPSA")
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), "Regulon"]
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), "Regulons"]
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
View(hazardous_regulons)
tnsPlotKM(rtns, regs = hazardous_regulons$Regulons)
View(rtns)
View(rtns@results[["KM"]][["Table"]])
km <- rtns@results$KM$Table
regu <- km[km$Adjusted.Pvalue < 0.01, ]
View(regu)
View(km)
tnsPlotKM(rtns, regs = regu$Regulons)
tnsPlotKM(rtns, regs = regu$Regulons)
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 14,
pAdjustMethod = "bonferroni")
rtns <- tnsGSEA2(rtns)
gdata::keep(subgroup, bad_samples, sure = T)
load(paste0("./rdata_files/network/", subgroup, "_rtn.RData"))
metadata <- read_ods("./input_files/data.ods", skip = 1)
colnames(metadata) <- tolower(colnames(metadata))
metadata$subgroup <- tolower(metadata$subgroup)
metadata$subgroup[metadata$subgroup == "group3"] <- "g3"
metadata$subgroup[metadata$subgroup == "group4"] <- "g4"
if(subgroup == "g34"){
metadata <- metadata[(metadata$subgroup == "g3" | metadata$subgroup == "g4"), ]
}else{
metadata <- metadata[metadata$subgroup == subgroup, ]
}
samples <- paste0("./input_files/", subgroup)
subgroup_samples <- oligoClasses::list.celfiles(samples, full.names = FALSE)
rownames(metadata) <- subgroup_samples
bad_samples <- bad_samples_list[[subgroup]]
metadata <- metadata[!(subgroup_samples %in% bad_samples), ]
#"event" and "time" variables are required, so we make them easier to identify
metadata <- dplyr::rename(metadata, event = dead, time = `os (years)`)
metadata <- dplyr::select(metadata, time, event, everything())
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 14,
pAdjustMethod = "bonferroni")
rtns <- tnsGSEA2(rtns)
rtns <- tnsCox(rtns)
rtns <- tnsKM(rtns)
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
km <- rtns@results$KM$Table
regu <- km[km$Adjusted.Pvalue < 0.01, ]
View(hazardous_regulons)
tnsPlotKM(rtns, regs = hazardous_regulons$Regulons)
intersect(regu, hazardous_regulons)
intersect.Vector(regu$Regulons, hazardous_regulons$Regulons)
gdata::keep(subgroup, bad_samples, sure = T)
load(paste0("./rdata_files/network/", subgroup, "_rtn.RData"))
metadata <- read_ods("./input_files/data.ods", skip = 1)
colnames(metadata) <- tolower(colnames(metadata))
metadata$subgroup <- tolower(metadata$subgroup)
metadata$subgroup[metadata$subgroup == "group3"] <- "g3"
metadata$subgroup[metadata$subgroup == "group4"] <- "g4"
if(subgroup == "g34"){
metadata <- metadata[(metadata$subgroup == "g3" | metadata$subgroup == "g4"), ]
}else{
metadata <- metadata[metadata$subgroup == subgroup, ]
}
samples <- paste0("./input_files/", subgroup)
subgroup_samples <- oligoClasses::list.celfiles(samples, full.names = FALSE)
rownames(metadata) <- subgroup_samples
bad_samples <- bad_samples_list[[subgroup]]
metadata <- metadata[!(subgroup_samples %in% bad_samples), ]
#"event" and "time" variables are required, so we make them easier to identify
metadata <- dplyr::rename(metadata, event = dead, time = `os (years)`)
metadata <- dplyr::select(metadata, time, event, everything())
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 10,
pAdjustMethod = "bonferroni")
rtns <- tnsGSEA2(rtns)
rtns <- tnsCox(rtns)
rtns <- tnsKM(rtns)
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
km <- rtns@results$KM$Table
View(cox)
tnsPlotCox(rtns)
rm(rtns)
?tni2mbrPreprocess
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 20,
pAdjustMethod = "bonferroni")
rtns <- tnsGSEA2(rtns)
rtns <- tnsCox(rtns)
rtns <- tnsKM(rtns)
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
km <- rtns@results$KM$Table
km <- km[km$Adjusted.Pvalue < 0.01, ]
View(hazardous_regulons)
View(km)
?p.adjust
?tni2tnsPreprocess
rm(rtns)
rtns <- tni2tnsPreprocess(rtni, survivalData = metadata,
time = 1, event = 2, endpoint = 20,
pAdjustMethod = "BH")
rtns <- tnsGSEA2(rtns)
rtns <- tnsCox(rtns)
rtns <- tnsKM(rtns)
cox <- rtns@results$Cox$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), ]
km <- rtns@results$KM$Table
km <- km[km$Adjusted.Pvalue < 0.01, ]
View(cox)
View(hazardous_regulons)
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1), cox$Adjusted.Pvalue <= 0.01]
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1) &
cox$Adjusted.Pvalue <= 0.01, ]
km <- rtns@results$KM$Table
km <- km[km$Adjusted.Pvalue < 0.01, ]
intersect(hazardous_regulons$Regulons, km$Regulons)
View(cox)
View(km)
View(km)
?intersect
cox <- rtns@results$Cox$Table
km <- rtns@results$KM$Table
hazardous_regulons <- cox[(cox$Lower95 > 1 | cox$Upper95 < 1) &
cox$Adjusted.Pvalue <= 0.01, ]
km <- km[km$Adjusted.Pvalue < 0.01, ]
hazardous_regulons <- base::intersect(hazardous_regulons$Regulons, km$Regulons)
if(length(hazardous_regulons) > 0){
tnsPlotKM(rtns, regs = hazardous_regulons,
fname = paste0(subgroup, "_km"),
fpath = paste0("./survival_plots/", subgroup),
plotpdf = T, plotbatch = T, xlab = "Years")
}
save(rtns, hazardous_regulons, file = paste0("./rdata_files/survival/",
subgroup, "_survival.RData"))
load("/data4/tayrone25/medulloblastoma/expression_analysis/rdata_files/survival/g34_survival.RData")
library(RTNsurvival)
subgroup <- "g34"
tnsPlotKM(rtns, regs = c("FBXO2", "KIF2C", "PPFIA4"),
fname = "regulons_of_interest_km",
fpath = paste0("./survival_plots/", subgroup),
plotpdf = T, plotbatch = T, xlab = "Years")
